<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Elasticsearch,大数据," />





  <link rel="alternate" href="/atom.xml" title="全科-不安分的码农" type="application/atom+xml" />






<meta name="description" content="本节介绍以下 CRUD API：  单文档  APIs  Index API Get API Delete API Delete By Query API Update API  多文档 APIs  Multi Get API Bulk API Using Bulk Processor  Multi Get APIBulk API  注意:所有的单文档的CRUD API，index参数只能接受单一">
<meta name="keywords" content="Elasticsearch,大数据">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch Java API 索引的增删改查（二）">
<meta property="og:url" content="http://quanke.name/2017/11/15/lasticsearch-Java-API-索引的增删改查（二）/index.html">
<meta property="og:site_name" content="全科-不安分的码农">
<meta property="og:description" content="本节介绍以下 CRUD API：  单文档  APIs  Index API Get API Delete API Delete By Query API Update API  多文档 APIs  Multi Get API Bulk API Using Bulk Processor  Multi Get APIBulk API  注意:所有的单文档的CRUD API，index参数只能接受单一">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://static.oschina.net/uploads/img/201711/08183543_ysUa.jpg">
<meta property="og:updated_time" content="2017-11-15T12:39:40.473Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Elasticsearch Java API 索引的增删改查（二）">
<meta name="twitter:description" content="本节介绍以下 CRUD API：  单文档  APIs  Index API Get API Delete API Delete By Query API Update API  多文档 APIs  Multi Get API Bulk API Using Bulk Processor  Multi Get APIBulk API  注意:所有的单文档的CRUD API，index参数只能接受单一">
<meta name="twitter:image" content="https://static.oschina.net/uploads/img/201711/08183543_ysUa.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://quanke.name/2017/11/15/lasticsearch-Java-API-索引的增删改查（二）/"/>





  <title>Elasticsearch Java API 索引的增删改查（二） | 全科-不安分的码农</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?853906ed403c461b2dbf1df696bdf998";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">全科-不安分的码农</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">android，ios，html5，微服务架构，XP，scrum，项目管理（PMP）</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://quanke.name/2017/11/15/lasticsearch-Java-API-索引的增删改查（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="全科">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="全科-不安分的码农">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Elasticsearch Java API 索引的增删改查（二）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-15T20:10:00+08:00">
                2017-11-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">Elasticsearch</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/15/lasticsearch-Java-API-索引的增删改查（二）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/11/15/lasticsearch-Java-API-索引的增删改查（二）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本节介绍以下 CRUD API：</p>
<p> 单文档  APIs</p>
<ul>
<li><a href="document-apis/index-api.md">Index API</a></li>
<li><a href="document-apis/get-api.md">Get API</a></li>
<li><a href="document-apis/delete-api.md">Delete API</a></li>
<li><a href="document-apis/delete-by-query-api.md">Delete By Query API</a></li>
<li><a href="document-apis/update-api.md">Update API</a></li>
</ul>
<p>多文档 APIs</p>
<ul>
<li><a href="document-apis/multi-get-api.md">Multi Get API</a></li>
<li><a href="document-apis/bulk-api.md">Bulk API</a></li>
<li><a href="document-apis/using-bulk-processor.md">Using Bulk Processor</a></li>
</ul>
<p>Multi Get API<br>Bulk API</p>
<blockquote>
<p>注意:所有的单文档的CRUD API，index参数只能接受单一的索引库名称，或者是一个指向单一索引库的alias。</p>
</blockquote>
<h3 id="Index-API"><a href="#Index-API" class="headerlink" title="Index API"></a>Index API</h3><p>Index API 允许我们存储一个JSON格式的文档，使数据可以被搜索。文档通过index、type、id唯一确定。我们可以自己提供一个id，或者也使用Index API 为我们自动生成一个。</p>
<p>这里有几种不同的方式来产生JSON格式的文档(document)：</p>
<ul>
<li>手动方式，使用原生的byte[]或者String</li>
<li>使用Map方式，会自动转换成与之等价的JSON</li>
<li>使用第三方库来序列化beans，如Jackson</li>
<li>使用内置的帮助类 XContentFactory.jsonBuilder()</li>
</ul>
<h4 id="手动方式"><a href="#手动方式" class="headerlink" title="手动方式"></a>手动方式</h4><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/mapping-date-format.html" target="_blank" rel="external">数据格式</a><br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">String json = &quot;&#123;&quot; +</div><div class="line">        &quot;\&quot;user\&quot;:\&quot;kimchy\&quot;,&quot; +</div><div class="line">        &quot;\&quot;postDate\&quot;:\&quot;2013-01-30\&quot;,&quot; +</div><div class="line">        &quot;\&quot;message\&quot;:\&quot;trying out Elasticsearch\&quot;&quot; +</div><div class="line">    &quot;&#125;&quot;;</div></pre></td></tr></table></figure></p>
<h5 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h5><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/**  </div><div class="line"> * 手动生成JSON  </div><div class="line"> */  </div><div class="line">@Test  </div><div class="line">public void CreateJSON()&#123;  </div><div class="line">      </div><div class="line">    String json = &quot;&#123;&quot; +  </div><div class="line">            &quot;\&quot;user\&quot;:\&quot;fendo\&quot;,&quot; +  </div><div class="line">            &quot;\&quot;postDate\&quot;:\&quot;2013-01-30\&quot;,&quot; +  </div><div class="line">            &quot;\&quot;message\&quot;:\&quot;Hell word\&quot;&quot; +  </div><div class="line">        &quot;&#125;&quot;;  </div><div class="line">      </div><div class="line">    IndexResponse response = client.prepareIndex(&quot;fendo&quot;, &quot;fendodate&quot;)  </div><div class="line">            .setSource(json)  </div><div class="line">            .get();  </div><div class="line">    System.out.println(response.getResult());  </div><div class="line">      </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Map方式"><a href="#Map方式" class="headerlink" title="Map方式"></a>Map方式</h4><p>Map是key:value数据类型，可以代表json结构.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Map&lt;String, Object&gt; json = new HashMap&lt;String, Object&gt;();</div><div class="line">json.put(&quot;user&quot;,&quot;kimchy&quot;);</div><div class="line">json.put(&quot;postDate&quot;,new Date());</div><div class="line">json.put(&quot;message&quot;,&quot;trying out Elasticsearch&quot;);</div></pre></td></tr></table></figure>
<h5 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h5><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"> /**  </div><div class="line"> * 使用集合  </div><div class="line"> */  </div><div class="line">@Test  </div><div class="line">public void CreateList()&#123;  </div><div class="line">      </div><div class="line">    Map&lt;String, Object&gt; json = new HashMap&lt;String, Object&gt;();  </div><div class="line">    json.put(&quot;user&quot;,&quot;kimchy&quot;);  </div><div class="line">    json.put(&quot;postDate&quot;,&quot;2013-01-30&quot;);  </div><div class="line">    json.put(&quot;message&quot;,&quot;trying out Elasticsearch&quot;);  </div><div class="line">      </div><div class="line">    IndexResponse response = client.prepareIndex(&quot;fendo&quot;, &quot;fendodate&quot;)  </div><div class="line">            .setSource(json)  </div><div class="line">            .get();  </div><div class="line">    System.out.println(response.getResult());  </div><div class="line">      </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="序列化方式"><a href="#序列化方式" class="headerlink" title="序列化方式"></a>序列化方式</h4><p>ElasticSearch已经使用了jackson，可以直接使用它把javabean转为json.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">import com.fasterxml.jackson.databind.*;</div><div class="line"></div><div class="line">// instance a json mapper</div><div class="line">ObjectMapper mapper = new ObjectMapper(); // create once, reuse</div><div class="line"></div><div class="line">// generate json</div><div class="line">byte[] json = mapper.writeValueAsBytes(yourbeaninstance);</div></pre></td></tr></table></figure>
<h5 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h5><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/**  </div><div class="line"> * 使用JACKSON序列化  </div><div class="line"> * @throws Exception  </div><div class="line"> */  </div><div class="line">@Test  </div><div class="line">public void CreateJACKSON() throws Exception&#123;  </div><div class="line">      </div><div class="line">    CsdnBlog csdn=new CsdnBlog();  </div><div class="line">    csdn.setAuthor(&quot;fendo&quot;);  </div><div class="line">    csdn.setContent(&quot;这是JAVA书籍&quot;);  </div><div class="line">    csdn.setTag(&quot;C&quot;);  </div><div class="line">    csdn.setView(&quot;100&quot;);  </div><div class="line">    csdn.setTitile(&quot;编程&quot;);  </div><div class="line">    csdn.setDate(new Date().toString());  </div><div class="line">      </div><div class="line">    // instance a json mapper  </div><div class="line">    ObjectMapper mapper = new ObjectMapper(); // create once, reuse  </div><div class="line"></div><div class="line">    // generate json  </div><div class="line">    byte[] json = mapper.writeValueAsBytes(csdn);  </div><div class="line">      </div><div class="line">    IndexResponse response = client.prepareIndex(&quot;fendo&quot;, &quot;fendodate&quot;)  </div><div class="line">            .setSource(json)  </div><div class="line">            .get();  </div><div class="line">    System.out.println(response.getResult());  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="XContentBuilder帮助类方式"><a href="#XContentBuilder帮助类方式" class="headerlink" title="XContentBuilder帮助类方式"></a>XContentBuilder帮助类方式</h4><p>ElasticSearch提供了一个内置的帮助类XContentBuilder来产生JSON文档</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">// Index name</div><div class="line">String _index = response.getIndex();</div><div class="line">// Type name</div><div class="line">String _type = response.getType();</div><div class="line">// Document ID (generated or not)</div><div class="line">String _id = response.getId();</div><div class="line">// Version (if it&apos;s the first time you index this document, you will get: 1)</div><div class="line">long _version = response.getVersion();</div><div class="line">// status has stored current instance statement.</div><div class="line">RestStatus status = response.status();</div></pre></td></tr></table></figure>
<h5 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h5><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/**  </div><div class="line"> * 使用ElasticSearch 帮助类  </div><div class="line"> * @throws IOException   </div><div class="line"> */  </div><div class="line">@Test  </div><div class="line">public void CreateXContentBuilder() throws IOException&#123;  </div><div class="line">      </div><div class="line">    XContentBuilder builder = XContentFactory.jsonBuilder()  </div><div class="line">            .startObject()  </div><div class="line">                .field(&quot;user&quot;, &quot;ccse&quot;)  </div><div class="line">                .field(&quot;postDate&quot;, new Date())  </div><div class="line">                .field(&quot;message&quot;, &quot;this is Elasticsearch&quot;)  </div><div class="line">            .endObject();  </div><div class="line">      </div><div class="line">    IndexResponse response = client.prepareIndex(&quot;fendo&quot;, &quot;fendodata&quot;).setSource(builder).get();  </div><div class="line">    System.out.println(&quot;创建成功!&quot;);  </div><div class="line">      </div><div class="line">      </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="综合实例"><a href="#综合实例" class="headerlink" title="综合实例"></a>综合实例</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"> </div><div class="line">import java.io.IOException;  </div><div class="line">import java.net.InetAddress;  </div><div class="line">import java.net.UnknownHostException;  </div><div class="line">import java.util.Date;  </div><div class="line">import java.util.HashMap;  </div><div class="line">import java.util.Map;  </div><div class="line">  </div><div class="line">import org.elasticsearch.action.index.IndexResponse;  </div><div class="line">import org.elasticsearch.client.transport.TransportClient;  </div><div class="line">import org.elasticsearch.common.settings.Settings;  </div><div class="line">import org.elasticsearch.common.transport.InetSocketTransportAddress;  </div><div class="line">import org.elasticsearch.common.xcontent.XContentBuilder;  </div><div class="line">import org.elasticsearch.common.xcontent.XContentFactory;  </div><div class="line">import org.elasticsearch.transport.client.PreBuiltTransportClient;  </div><div class="line">import org.junit.Before;  </div><div class="line">import org.junit.Test;  </div><div class="line">  </div><div class="line">import com.fasterxml.jackson.core.JsonProcessingException;  </div><div class="line">import com.fasterxml.jackson.databind.ObjectMapper;  </div><div class="line">  </div><div class="line">public class CreateIndex &#123;  </div><div class="line">  </div><div class="line">    private TransportClient client;  </div><div class="line">      </div><div class="line">    @Before  </div><div class="line">    public void getClient() throws Exception&#123;  </div><div class="line">        //设置集群名称  </div><div class="line">        Settings settings = Settings.builder().put(&quot;cluster.name&quot;, &quot;my-application&quot;).build();// 集群名  </div><div class="line">        //创建client  </div><div class="line">        client  = new PreBuiltTransportClient(settings)  </div><div class="line">                .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(&quot;127.0.0.1&quot;), 9300));  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    /**  </div><div class="line">     * 手动生成JSON  </div><div class="line">     */  </div><div class="line">    @Test  </div><div class="line">    public void CreateJSON()&#123;  </div><div class="line">          </div><div class="line">        String json = &quot;&#123;&quot; +  </div><div class="line">                &quot;\&quot;user\&quot;:\&quot;fendo\&quot;,&quot; +  </div><div class="line">                &quot;\&quot;postDate\&quot;:\&quot;2013-01-30\&quot;,&quot; +  </div><div class="line">                &quot;\&quot;message\&quot;:\&quot;Hell word\&quot;&quot; +  </div><div class="line">            &quot;&#125;&quot;;  </div><div class="line">          </div><div class="line">        IndexResponse response = client.prepareIndex(&quot;fendo&quot;, &quot;fendodate&quot;)  </div><div class="line">                .setSource(json)  </div><div class="line">                .get();  </div><div class="line">        System.out.println(response.getResult());  </div><div class="line">          </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">      </div><div class="line">    /**  </div><div class="line">     * 使用集合  </div><div class="line">     */  </div><div class="line">    @Test  </div><div class="line">    public void CreateList()&#123;  </div><div class="line">          </div><div class="line">        Map&lt;String, Object&gt; json = new HashMap&lt;String, Object&gt;();  </div><div class="line">        json.put(&quot;user&quot;,&quot;kimchy&quot;);  </div><div class="line">        json.put(&quot;postDate&quot;,&quot;2013-01-30&quot;);  </div><div class="line">        json.put(&quot;message&quot;,&quot;trying out Elasticsearch&quot;);  </div><div class="line">          </div><div class="line">        IndexResponse response = client.prepareIndex(&quot;fendo&quot;, &quot;fendodate&quot;)  </div><div class="line">                .setSource(json)  </div><div class="line">                .get();  </div><div class="line">        System.out.println(response.getResult());  </div><div class="line">          </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    /**  </div><div class="line">     * 使用JACKSON序列化  </div><div class="line">     * @throws Exception  </div><div class="line">     */  </div><div class="line">    @Test  </div><div class="line">    public void CreateJACKSON() throws Exception&#123;  </div><div class="line">          </div><div class="line">        CsdnBlog csdn=new CsdnBlog();  </div><div class="line">        csdn.setAuthor(&quot;fendo&quot;);  </div><div class="line">        csdn.setContent(&quot;这是JAVA书籍&quot;);  </div><div class="line">        csdn.setTag(&quot;C&quot;);  </div><div class="line">        csdn.setView(&quot;100&quot;);  </div><div class="line">        csdn.setTitile(&quot;编程&quot;);  </div><div class="line">        csdn.setDate(new Date().toString());  </div><div class="line">          </div><div class="line">        // instance a json mapper  </div><div class="line">        ObjectMapper mapper = new ObjectMapper(); // create once, reuse  </div><div class="line">  </div><div class="line">        // generate json  </div><div class="line">        byte[] json = mapper.writeValueAsBytes(csdn);  </div><div class="line">          </div><div class="line">        IndexResponse response = client.prepareIndex(&quot;fendo&quot;, &quot;fendodate&quot;)  </div><div class="line">                .setSource(json)  </div><div class="line">                .get();  </div><div class="line">        System.out.println(response.getResult());  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    /**  </div><div class="line">     * 使用ElasticSearch 帮助类  </div><div class="line">     * @throws IOException   </div><div class="line">     */  </div><div class="line">    @Test  </div><div class="line">    public void CreateXContentBuilder() throws IOException&#123;  </div><div class="line">          </div><div class="line">        XContentBuilder builder = XContentFactory.jsonBuilder()  </div><div class="line">                .startObject()  </div><div class="line">                    .field(&quot;user&quot;, &quot;ccse&quot;)  </div><div class="line">                    .field(&quot;postDate&quot;, new Date())  </div><div class="line">                    .field(&quot;message&quot;, &quot;this is Elasticsearch&quot;)  </div><div class="line">                .endObject();  </div><div class="line">          </div><div class="line">        IndexResponse response = client.prepareIndex(&quot;fendo&quot;, &quot;fendodata&quot;).setSource(builder).get();  </div><div class="line">        System.out.println(&quot;创建成功!&quot;);  </div><div class="line">          </div><div class="line">          </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>你还可以通过startArray(string)和endArray()方法添加数组。.field()方法可以接受多种对象类型。你可以给它传递数字、日期、甚至其他XContentBuilder对象。</p>
</blockquote>
<h3 id="Get-API"><a href="#Get-API" class="headerlink" title="Get API"></a>Get API</h3><p>根据id查看文档：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">GetResponse response = client.prepareGet(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;).get();</div></pre></td></tr></table></figure>
<p>更多请查看 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/docs-get.html" target="_blank" rel="external">rest get API</a> 文档</p>
<h4 id="配置线程"><a href="#配置线程" class="headerlink" title="配置线程"></a>配置线程</h4><p><code>operationThreaded</code> 设置为 <code>true</code> 是在不同的线程里执行此次操作</p>
<p>下面的例子是<code>operationThreaded</code> 设置为 <code>false</code> ：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">GetResponse response = client.prepareGet(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;)</div><div class="line">        .setOperationThreaded(false)</div><div class="line">        .get();</div></pre></td></tr></table></figure></p>
<h3 id="Delete-API"><a href="#Delete-API" class="headerlink" title="Delete API"></a>Delete API</h3><p>根据ID删除：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">DeleteResponse response = client.prepareDelete(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;).get();</div></pre></td></tr></table></figure>
<p>更多请查看 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/docs-delete.html" target="_blank" rel="external">delete API</a> 文档</p>
<h4 id="配置线程-1"><a href="#配置线程-1" class="headerlink" title="配置线程"></a>配置线程</h4><p><code>operationThreaded</code> 设置为 <code>true</code> 是在不同的线程里执行此次操作</p>
<p>下面的例子是<code>operationThreaded</code> 设置为 <code>false</code> ：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">GetResponse response = client.prepareGet(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;)</div><div class="line">        .setOperationThreaded(false)</div><div class="line">        .get();</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">DeleteResponse response = client.prepareDelete(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;)</div><div class="line">        .setOperationThreaded(false)</div><div class="line">        .get();</div></pre></td></tr></table></figure>
<h3 id="Delete-By-Query-API"><a href="#Delete-By-Query-API" class="headerlink" title="Delete By Query API"></a>Delete By Query API</h3><p>通过查询条件删除</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BulkByScrollResponse response =</div><div class="line">    DeleteByQueryAction.INSTANCE.newRequestBuilder(client)</div><div class="line">        .filter(QueryBuilders.matchQuery(&quot;gender&quot;, &quot;male&quot;)) //查询条件</div><div class="line">        .source(&quot;persons&quot;) //index(索引名)</div><div class="line">        .get();  //执行</div><div class="line"></div><div class="line">long deleted = response.getDeleted(); //删除文档的数量</div></pre></td></tr></table></figure>
<p>如果需要执行的时间比较长，可以使用异步的方式处理,结果在回调里面获取</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">DeleteByQueryAction.INSTANCE.newRequestBuilder(client)</div><div class="line">    .filter(QueryBuilders.matchQuery(&quot;gender&quot;, &quot;male&quot;))      //查询            </div><div class="line">    .source(&quot;persons&quot;)                //index(索引名)                                    </div><div class="line">    .execute(new ActionListener&lt;BulkByScrollResponse&gt;() &#123;     //回调监听     </div><div class="line">        @Override</div><div class="line">        public void onResponse(BulkByScrollResponse response) &#123;</div><div class="line">            long deleted = response.getDeleted();   //删除文档的数量                 </div><div class="line">        &#125;</div><div class="line">        @Override</div><div class="line">        public void onFailure(Exception e) &#123;</div><div class="line">            // Handle the exception</div><div class="line">        &#125;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<h3 id="Update-API"><a href="#Update-API" class="headerlink" title="Update API"></a>Update API</h3><p>有两种方式更新索引：</p>
<ul>
<li>创建 <code>UpdateRequest</code>,通过client发送；</li>
<li>使用 <code>prepareUpdate()</code> 方法；</li>
</ul>
<h4 id="使用UpdateRequest"><a href="#使用UpdateRequest" class="headerlink" title="使用UpdateRequest"></a>使用UpdateRequest</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">UpdateRequest updateRequest = new UpdateRequest();</div><div class="line">updateRequest.index(&quot;index&quot;);</div><div class="line">updateRequest.type(&quot;type&quot;);</div><div class="line">updateRequest.id(&quot;1&quot;);</div><div class="line">updateRequest.doc(jsonBuilder()</div><div class="line">        .startObject()</div><div class="line">            .field(&quot;gender&quot;, &quot;male&quot;)</div><div class="line">        .endObject());</div><div class="line">client.update(updateRequest).get();</div></pre></td></tr></table></figure>
<h4 id="使用-prepareUpdate-方法"><a href="#使用-prepareUpdate-方法" class="headerlink" title="使用 prepareUpdate() 方法"></a>使用 <code>prepareUpdate()</code> 方法</h4><blockquote>
<p>这里官方的示例有问题，new Script（）参数错误，所以一下代码是我自己写的（2017/11/10）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">client.prepareUpdate(&quot;ttl&quot;, &quot;doc&quot;, &quot;1&quot;)</div><div class="line">        .setScript(new Script(&quot;ctx._source.gender = \&quot;male\&quot;&quot;  ,ScriptService.ScriptType.INLINE, null, null))//脚本可以是本地文件存储的，如果使用文件存储的脚本，需要设置 ScriptService.ScriptType.FILE </div><div class="line">        .get();</div><div class="line"></div><div class="line">client.prepareUpdate(&quot;ttl&quot;, &quot;doc&quot;, &quot;1&quot;)</div><div class="line">        .setDoc(jsonBuilder()   //合并到现有文档</div><div class="line">            .startObject()</div><div class="line">                .field(&quot;gender&quot;, &quot;male&quot;)</div><div class="line">            .endObject())</div><div class="line">        .get();</div></pre></td></tr></table></figure>
<h4 id="Update-by-script"><a href="#Update-by-script" class="headerlink" title="Update by script"></a>Update by script</h4><p>使用脚本更新文档 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">UpdateRequest updateRequest = new UpdateRequest(&quot;ttl&quot;, &quot;doc&quot;, &quot;1&quot;)</div><div class="line">        .script(new Script(&quot;ctx._source.gender = \&quot;male\&quot;&quot;));</div><div class="line">client.update(updateRequest).get();</div></pre></td></tr></table></figure>
<h4 id="Update-by-merging-documents"><a href="#Update-by-merging-documents" class="headerlink" title="Update by merging documents"></a>Update by merging documents</h4><p>合并文档</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">UpdateRequest updateRequest = new UpdateRequest(&quot;index&quot;, &quot;type&quot;, &quot;1&quot;)</div><div class="line">        .doc(jsonBuilder()</div><div class="line">            .startObject()</div><div class="line">                .field(&quot;gender&quot;, &quot;male&quot;)</div><div class="line">            .endObject());</div><div class="line">client.update(updateRequest).get();</div></pre></td></tr></table></figure>
<h4 id="Upsert"><a href="#Upsert" class="headerlink" title="Upsert"></a>Upsert</h4><p>更新插入,如果存在文档就更新，如果不存在就插入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">IndexRequest indexRequest = new IndexRequest(&quot;index&quot;, &quot;type&quot;, &quot;1&quot;)</div><div class="line">        .source(jsonBuilder()</div><div class="line">            .startObject()</div><div class="line">                .field(&quot;name&quot;, &quot;Joe Smith&quot;)</div><div class="line">                .field(&quot;gender&quot;, &quot;male&quot;)</div><div class="line">            .endObject());</div><div class="line">UpdateRequest updateRequest = new UpdateRequest(&quot;index&quot;, &quot;type&quot;, &quot;1&quot;)</div><div class="line">        .doc(jsonBuilder()</div><div class="line">            .startObject()</div><div class="line">                .field(&quot;gender&quot;, &quot;male&quot;)</div><div class="line">            .endObject())</div><div class="line">        .upsert(indexRequest); //如果不存在此文档 ，就增加 `indexRequest`</div><div class="line">client.update(updateRequest).get();</div></pre></td></tr></table></figure>
<p>如果 <code>index/type/1</code> 存在，类似下面的文档：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;name&quot;  : &quot;Joe Dalton&quot;,</div><div class="line">    &quot;gender&quot;: &quot;male&quot;        </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果不存在，会插入新的文档：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;name&quot; : &quot;Joe Smith&quot;,</div><div class="line">    &quot;gender&quot;: &quot;male&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Multi-Get-API"><a href="#Multi-Get-API" class="headerlink" title="Multi Get API"></a>Multi Get API</h3><p>一次获取多个文档</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">MultiGetResponse multiGetItemResponses = client.prepareMultiGet()</div><div class="line">    .add(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;) //一个id的方式</div><div class="line">    .add(&quot;twitter&quot;, &quot;tweet&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;) //多个id的方式</div><div class="line">    .add(&quot;another&quot;, &quot;type&quot;, &quot;foo&quot;)  //可以从另外一个索引获取</div><div class="line">    .get();</div><div class="line"></div><div class="line">for (MultiGetItemResponse itemResponse : multiGetItemResponses) &#123; //迭代返回值</div><div class="line">    GetResponse response = itemResponse.getResponse();</div><div class="line">    if (response.isExists()) &#123;      //判断是否存在                </div><div class="line">        String json = response.getSourceAsString(); //_source 字段</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>更多请浏览REST <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/docs-multi-get.html" target="_blank" rel="external">multi get</a> 文档</p>
<h3 id="Bulk-API"><a href="#Bulk-API" class="headerlink" title="Bulk API"></a>Bulk API</h3><p>Bulk API，批量插入：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">import static org.elasticsearch.common.xcontent.XContentFactory.*;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BulkRequestBuilder bulkRequest = client.prepareBulk();</div><div class="line"></div><div class="line">// either use client#prepare, or use Requests# to directly build index/delete requests</div><div class="line">bulkRequest.add(client.prepareIndex(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;)</div><div class="line">        .setSource(jsonBuilder()</div><div class="line">                    .startObject()</div><div class="line">                        .field(&quot;user&quot;, &quot;kimchy&quot;)</div><div class="line">                        .field(&quot;postDate&quot;, new Date())</div><div class="line">                        .field(&quot;message&quot;, &quot;trying out Elasticsearch&quot;)</div><div class="line">                    .endObject()</div><div class="line">                  )</div><div class="line">        );</div><div class="line"></div><div class="line">bulkRequest.add(client.prepareIndex(&quot;twitter&quot;, &quot;tweet&quot;, &quot;2&quot;)</div><div class="line">        .setSource(jsonBuilder()</div><div class="line">                    .startObject()</div><div class="line">                        .field(&quot;user&quot;, &quot;kimchy&quot;)</div><div class="line">                        .field(&quot;postDate&quot;, new Date())</div><div class="line">                        .field(&quot;message&quot;, &quot;another post&quot;)</div><div class="line">                    .endObject()</div><div class="line">                  )</div><div class="line">        );</div><div class="line"></div><div class="line">BulkResponse bulkResponse = bulkRequest.get();</div><div class="line">if (bulkResponse.hasFailures()) &#123;</div><div class="line">    // process failures by iterating through each bulk response item</div><div class="line">    //处理失败</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用-Bulk-Processor"><a href="#使用-Bulk-Processor" class="headerlink" title="使用 Bulk Processor"></a>使用 Bulk Processor</h3><p>BulkProcessor 提供了一个简单的接口，在给定的大小数量上定时批量自动请求</p>
<h4 id="创建BulkProcessor实例"><a href="#创建BulkProcessor实例" class="headerlink" title="创建BulkProcessor实例"></a>创建<code>BulkProcessor</code>实例</h4><p>首先创建<code>BulkProcessor</code>实例</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">import org.elasticsearch.action.bulk.BackoffPolicy;</div><div class="line">import org.elasticsearch.action.bulk.BulkProcessor;</div><div class="line">import org.elasticsearch.common.unit.ByteSizeUnit;</div><div class="line">import org.elasticsearch.common.unit.ByteSizeValue;</div><div class="line">import org.elasticsearch.common.unit.TimeValue;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BulkProcessor bulkProcessor = BulkProcessor.builder(</div><div class="line">        client,  //增加elasticsearch客户端</div><div class="line">        new BulkProcessor.Listener() &#123;</div><div class="line">            @Override</div><div class="line">            public void beforeBulk(long executionId,</div><div class="line">                                   BulkRequest request) &#123; ... &#125; //调用bulk之前执行 ，例如你可以通过request.numberOfActions()方法知道numberOfActions</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void afterBulk(long executionId,</div><div class="line">                                  BulkRequest request,</div><div class="line">                                  BulkResponse response) &#123; ... &#125; //调用bulk之后执行 ，例如你可以通过request.hasFailures()方法知道是否执行失败</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void afterBulk(long executionId,</div><div class="line">                                  BulkRequest request,</div><div class="line">                                  Throwable failure) &#123; ... &#125; //调用失败抛 Throwable</div><div class="line">        &#125;)</div><div class="line">        .setBulkActions(10000) //每次10000请求</div><div class="line">        .setBulkSize(new ByteSizeValue(5, ByteSizeUnit.MB)) //拆成5mb一块</div><div class="line">        .setFlushInterval(TimeValue.timeValueSeconds(5)) //无论请求数量多少，每5秒钟请求一次。</div><div class="line">        .setConcurrentRequests(1) //设置并发请求的数量。值为0意味着只允许执行一个请求。值为1意味着允许1并发请求。</div><div class="line">        .setBackoffPolicy(</div><div class="line">            BackoffPolicy.exponentialBackoff(TimeValue.timeValueMillis(100), 3))//设置自定义重复请求机制，最开始等待100毫秒，之后成倍更加，重试3次，当一次或多次重复请求失败后因为计算资源不够抛出 EsRejectedExecutionException 异常，可以通过BackoffPolicy.noBackoff()方法关闭重试机制</div><div class="line">        .build();</div></pre></td></tr></table></figure>
<h4 id="BulkProcessor-默认设置"><a href="#BulkProcessor-默认设置" class="headerlink" title="BulkProcessor 默认设置"></a>BulkProcessor 默认设置</h4><ul>
<li>bulkActions  1000 </li>
<li>bulkSize 5mb</li>
<li>不设置flushInterval</li>
<li>concurrentRequests 为 1 ，异步执行</li>
<li>backoffPolicy 重试 8次，等待50毫秒</li>
</ul>
<h4 id="增加requests"><a href="#增加requests" class="headerlink" title="增加requests"></a>增加requests</h4><p>然后增加<code>requests</code>到<code>BulkProcessor</code><br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">bulkProcessor.add(new IndexRequest(&quot;twitter&quot;, &quot;tweet&quot;, &quot;1&quot;).source(/* your doc here */));</div><div class="line">bulkProcessor.add(new DeleteRequest(&quot;twitter&quot;, &quot;tweet&quot;, &quot;2&quot;));</div></pre></td></tr></table></figure></p>
<h4 id="关闭-Bulk-Processor"><a href="#关闭-Bulk-Processor" class="headerlink" title="关闭 Bulk Processor"></a>关闭 Bulk Processor</h4><p>当所有文档都处理完成，使用<code>awaitClose</code> 或 <code>close</code> 方法关闭<code>BulkProcessor</code>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">bulkProcessor.awaitClose(10, TimeUnit.MINUTES);</div></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">bulkProcessor.close();</div></pre></td></tr></table></figure>
<h4 id="在测试中使用Bulk-Processor"><a href="#在测试中使用Bulk-Processor" class="headerlink" title="在测试中使用Bulk Processor"></a>在测试中使用Bulk Processor</h4><p>如果你在测试种使用<code>Bulk Processor</code>可以执行同步方法<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BulkProcessor bulkProcessor = BulkProcessor.builder(client, new BulkProcessor.Listener() &#123; /* Listener methods */ &#125;)</div><div class="line">        .setBulkActions(10000)</div><div class="line">        .setConcurrentRequests(0)</div><div class="line">        .build();</div><div class="line"></div><div class="line">// Add your requests</div><div class="line">bulkProcessor.add(/* Your requests */);</div><div class="line"></div><div class="line">// Flush any remaining requests</div><div class="line">bulkProcessor.flush();</div><div class="line"></div><div class="line">// Or close the bulkProcessor if you don&apos;t need it anymore</div><div class="line">bulkProcessor.close();</div><div class="line"></div><div class="line">// Refresh your indices</div><div class="line">client.admin().indices().prepareRefresh().get();</div><div class="line"></div><div class="line">// Now you can start searching!</div><div class="line">client.prepareSearch().get();</div></pre></td></tr></table></figure></p>
<p><a href="https://gitee.com/quanke/elasticsearch-java-study" target="_blank" rel="external">所有实例</a> 已经上传到Git</p>
<p>更多请浏览 <a href="https://github.com/quanke/spring-boot-starter-es" target="_blank" rel="external">spring-boot-starter-es</a> 开源项目</p>
<blockquote>
<p>如何有任何问题请关注微信公众号给我留言</p>
</blockquote>
<p><img src="https://static.oschina.net/uploads/img/201711/08183543_ysUa.jpg" alt="全科的公众号"></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Elasticsearch/" rel="tag"># Elasticsearch</a>
          
            <a href="/tags/大数据/" rel="tag"># 大数据</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/11/13/Elasticsearch-Java-API-客户端连接，TransportClient，PreBuiltXPackTransportClient（一）/" rel="next" title="Elasticsearch Java API - 客户端连接(TransportClient，PreBuiltXPackTransportClient)（一）">
                <i class="fa fa-chevron-left"></i> Elasticsearch Java API - 客户端连接(TransportClient，PreBuiltXPackTransportClient)（一）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2017/11/15/lasticsearch-Java-API-索引的增删改查（二）/"
     data-title="Elasticsearch Java API 索引的增删改查（二）"
     data-content=""
     data-url="http://quanke.name/2017/11/15/lasticsearch-Java-API-索引的增删改查（二）/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div class="ds-thread" data-thread-key="2017/11/15/lasticsearch-Java-API-索引的增删改查（二）/"
           data-title="Elasticsearch Java API 索引的增删改查（二）" data-url="http://quanke.name/2017/11/15/lasticsearch-Java-API-索引的增删改查（二）/">
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/dog.jpg"
                alt="全科" />
            
              <p class="site-author-name" itemprop="name">全科</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">118</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">41</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/quanke" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Index-API"><span class="nav-number">1.</span> <span class="nav-text">Index API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#手动方式"><span class="nav-number">1.1.</span> <span class="nav-text">手动方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#实例"><span class="nav-number">1.1.1.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Map方式"><span class="nav-number">1.2.</span> <span class="nav-text">Map方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#实例-1"><span class="nav-number">1.2.1.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#序列化方式"><span class="nav-number">1.3.</span> <span class="nav-text">序列化方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#实例-2"><span class="nav-number">1.3.1.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XContentBuilder帮助类方式"><span class="nav-number">1.4.</span> <span class="nav-text">XContentBuilder帮助类方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#实例-3"><span class="nav-number">1.4.1.</span> <span class="nav-text">实例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#综合实例"><span class="nav-number">1.5.</span> <span class="nav-text">综合实例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Get-API"><span class="nav-number">2.</span> <span class="nav-text">Get API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置线程"><span class="nav-number">2.1.</span> <span class="nav-text">配置线程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Delete-API"><span class="nav-number">3.</span> <span class="nav-text">Delete API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置线程-1"><span class="nav-number">3.1.</span> <span class="nav-text">配置线程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Delete-By-Query-API"><span class="nav-number">4.</span> <span class="nav-text">Delete By Query API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Update-API"><span class="nav-number">5.</span> <span class="nav-text">Update API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用UpdateRequest"><span class="nav-number">5.1.</span> <span class="nav-text">使用UpdateRequest</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用-prepareUpdate-方法"><span class="nav-number">5.2.</span> <span class="nav-text">使用 prepareUpdate() 方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Update-by-script"><span class="nav-number">5.3.</span> <span class="nav-text">Update by script</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Update-by-merging-documents"><span class="nav-number">5.4.</span> <span class="nav-text">Update by merging documents</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Upsert"><span class="nav-number">5.5.</span> <span class="nav-text">Upsert</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multi-Get-API"><span class="nav-number">6.</span> <span class="nav-text">Multi Get API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bulk-API"><span class="nav-number">7.</span> <span class="nav-text">Bulk API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-Bulk-Processor"><span class="nav-number">8.</span> <span class="nav-text">使用 Bulk Processor</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建BulkProcessor实例"><span class="nav-number">8.1.</span> <span class="nav-text">创建BulkProcessor实例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BulkProcessor-默认设置"><span class="nav-number">8.2.</span> <span class="nav-text">BulkProcessor 默认设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#增加requests"><span class="nav-number">8.3.</span> <span class="nav-text">增加requests</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关闭-Bulk-Processor"><span class="nav-number">8.4.</span> <span class="nav-text">关闭 Bulk Processor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在测试中使用Bulk-Processor"><span class="nav-number">8.5.</span> <span class="nav-text">在测试中使用Bulk Processor</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">全科</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"quanke"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  















<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>



  





  

  

  

  
  

  

  

  

</body>
</html>
